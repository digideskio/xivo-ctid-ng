{
    "swagger": "2.0",
    "info": {
        "title": "XiVO CTId ng",
        "description": "Control your calls from a REST API",
        "version": "1.0.0"
    },
    "schemes": [
        "https"
    ],
    "basePath": "/1.0",
    "produces": [
        "application/json"
    ],
    "x-xivo-port": 9500,
    "x-xivo-name": "ctid-ng",
    "paths": {
        "/calls": {
            "get": {
                "summary": "List calls",
                "description": "List calls",
                "parameters": [
                    {
                        "name": "application",
                        "description": "Filter calls by Stasis application, e.g. switchboard.",
                        "in": "query",
                        "type": "string"
                    },
                    {
                        "name": "application_instance",
                        "description": "Filter calls by Stasis application instance, e.g. switchboard-sales,green. This value filters on the channel variable XIVO_STASIS_ARGS. Args should be separated by commas (,).",
                        "in": "query",
                        "type": "string"
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "calls"
                ],
                "responses": {
                    "200": {
                        "description": "List currently active calls",
                        "schema": {
                            "type": "object",
                            "properties": {
                                "items": {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/definitions/Call"
                                    }
                                }
                            }
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            },
            "post": {
                "summary": "Make a new call",
                "description": "Create a new call from a phone to an extension.\n",
                "parameters": [
                    {
                        "name": "body",
                        "in": "body",
                        "description": "Call parameters",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/CallRequest"
                        }
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "calls"
                ],
                "responses": {
                    "201": {
                        "description": "The new call ID",
                        "schema": {
                            "$ref": "#/definitions/CallID"
                        }
                    },
                    "400": {
                        "description": "Invalid request",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/calls/{call_id}": {
            "get": {
                "summary": "Show a call",
                "description": "Get infos about a call",
                "parameters": [
                    {
                        "name": "call_id",
                        "in": "path",
                        "description": "ID of the call",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "calls"
                ],
                "responses": {
                    "200": {
                        "schema": {
                            "$ref": "#/definitions/Call"
                        }
                    },
                    "404": {
                        "description": "No such call",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            },
            "delete": {
                "summary": "Hangup a call",
                "description": "Hangup a call",
                "parameters": [
                    {
                        "name": "call_id",
                        "in": "path",
                        "description": "ID of the call",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "calls"
                ],
                "responses": {
                    "204": {
                        "description": "Call has been hung up"
                    },
                    "404": {
                        "description": "No such call",
                        "schema": {
                            "$ref": "#/definitions/Error"
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/calls/{call_id}/user/{user_uuid}": {
            "put": {
                "summary": "Connect a call to a user",
                "parameters": [
                    {
                        "name": "call_id",
                        "in": "path",
                        "description": "ID of the call",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "name": "user_uuid",
                        "in": "path",
                        "description": "UUID of the user",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "calls"
                ],
                "responses": {
                    "200": {
                        "description": "The new call of the user (ringing side)",
                        "schema": {
                            "$ref": "#/definitions/Call"
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/calls/{call_id}/transfer/ami/blind": {
            "post": {
                "summary": "Blind transfer a call (AMI)",
                "description": "Blind transfer a call (AMI)",
                "parameters": [
                    {
                        "name": "call_id",
                        "in": "path",
                        "description": "ID of the call transfered",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "name": "body",
                        "in": "body",
                        "description": "Call parameters",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/CallAMITransfer"
                        }
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "calls"
                ],
                "responses": {
                    "201": {
                        "description": "The new call ID",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Call"
                            }
                        }
                    },
                    "404": {
                        "description": "No such call",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Error"
                            }
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/calls/{call_id}/transfer/ami/attended": {
            "post": {
                "summary": "Attended transfer a call (AMI)",
                "description": "Attended transfer a call (AMI)",
                "parameters": [
                    {
                        "name": "call_id",
                        "in": "path",
                        "description": "ID of the call transfered",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "name": "body",
                        "in": "body",
                        "description": "Call parameters",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/CallAMITransfer"
                        }
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "calls"
                ],
                "responses": {
                    "201": {
                        "description": "The new call ID",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Call"
                            }
                        }
                    },
                    "404": {
                        "description": "No such call",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Error"
                            }
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/calls/{call_id}/transfer/{originator_call_id}/blind": {
            "post": {
                "summary": "Blind transfer a call",
                "description": "Blind transfer a call",
                "parameters": [
                    {
                        "name": "originator_call_id",
                        "in": "path",
                        "description": "ID of the originator",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "name": "call_id",
                        "in": "path",
                        "description": "ID of the call",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "name": "body",
                        "in": "body",
                        "description": "Call parameters",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/CallBlindTransfer"
                        }
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "calls"
                ],
                "responses": {
                    "201": {
                        "description": "The new call ID",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Call"
                            }
                        }
                    },
                    "404": {
                        "description": "No such call",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Error"
                            }
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/hold/{holding_id}/calls": {
            "get": {
                "summary": "List calls in hold",
                "description": "List calls in hold",
                "parameters": [
                    {
                        "name": "holding_id",
                        "in": "path",
                        "description": "Holding ID",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "hold"
                ],
                "responses": {
                    "201": {
                        "description": "The new call ID",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Call"
                            }
                        }
                    },
                    "404": {
                        "description": "No such call",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Error"
                            }
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/hold/{holding_id}": {
            "post": {
                "summary": "Create waiting room",
                "description": "Create waiting room",
                "parameters": [
                    {
                        "name": "holding_id",
                        "in": "path",
                        "description": "Holding ID",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "name": "body",
                        "in": "body",
                        "description": "Call hold parameters",
                        "required": false,
                        "schema": {
                            "$ref": "#/definitions/WaitingRoom"
                        }
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "hold"
                ],
                "responses": {
                    "201": {
                        "description": "The new call ID",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Call"
                            }
                        }
                    },
                    "404": {
                        "description": "No such call",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Error"
                            }
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            },
            "delete": {
                "summary": "Delete waiting room",
                "description": "Delete waiting room",
                "parameters": [
                    {
                        "name": "holding_id",
                        "in": "path",
                        "description": "Holding ID",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "hold"
                ],
                "responses": {
                    "200": {
                        "description": "Waiting room is destroyed"
                    },
                    "404": {
                        "description": "No such waiting call",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Error"
                            }
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/hold/{holding_id}/calls/{call_id}": {
            "put": {
                "summary": "Hold a call in a bridge",
                "description": "Hold a call in a bridge",
                "parameters": [
                    {
                        "name": "holding_id",
                        "in": "path",
                        "description": "ID of the holding bridge",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "name": "call_id",
                        "in": "path",
                        "description": "ID of the call",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "hold"
                ],
                "responses": {
                    "201": {
                        "description": "The new call ID",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Call"
                            }
                        }
                    },
                    "404": {
                        "description": "No such call",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Error"
                            }
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/incoming/{incoming_id}/calls": {
            "get": {
                "summary": "List incoming calls",
                "description": "List incoming calls",
                "parameters": [
                    {
                        "name": "incoming_id",
                        "in": "path",
                        "description": "Incoming ID",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "incoming"
                ],
                "responses": {
                    "201": {
                        "description": "The new call ID",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Call"
                            }
                        }
                    },
                    "404": {
                        "description": "No such call",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Error"
                            }
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/incoming/{incoming_id}/calls/{call_id}": {
            "put": {
                "summary": "Transfer a call to incoming room",
                "description": "Transfer a call to incoming",
                "parameters": [
                    {
                        "name": "incoming_id",
                        "in": "path",
                        "description": "ID of the incoming room",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "name": "call_id",
                        "in": "path",
                        "description": "ID of the call",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "incoming"
                ],
                "responses": {
                    "201": {
                        "description": "The new call ID",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Call"
                            }
                        }
                    },
                    "404": {
                        "description": "No such call",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Error"
                            }
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/calls/{call_id}/stasis": {
            "post": {
                "summary": "Transfer channel to stasis (AMI)",
                "description": "Transfer channel to stasis (AMI)",
                "parameters": [
                    {
                        "name": "call_id",
                        "in": "path",
                        "description": "ID of the call",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "calls"
                ],
                "responses": {
                    "201": {
                        "description": "The new call ID",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Call"
                            }
                        }
                    },
                    "404": {
                        "description": "No such call",
                        "schema": {
                            "type": "object",
                            "items": {
                                "$ref": "#/definitions/Error"
                            }
                        }
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/chat/": {
            "post": {
                "summary": "Send chat to user",
                "description": "Send chat to user",
                "parameters": [
                    {
                        "name": "body",
                        "in": "body",
                        "description": "Chat parameters",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/ChatRequest"
                        }
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "chat"
                ],
                "responses": {
                    "204": {
                        "description": "Message chat has been sent"
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        },
        "/presence/": {
            "put": {
                "summary": "Update CTI presence",
                "description": "Update CTI presence",
                "parameters": [
                    {
                        "name": "body",
                        "in": "body",
                        "description": "Presence parameters",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/PresenceRequest"
                        }
                    },
                    {
                        "$ref": "#/parameters/token"
                    }
                ],
                "tags": [
                    "presence"
                ],
                "responses": {
                    "204": {
                        "description": "Presence has been updated"
                    },
                    "503": {
                        "$ref": "#/responses/AnotherServiceUnavailable"
                    }
                }
            }
        }
    },
    "responses": {
        "AnotherServiceUnavailable": {
            "description": "Another service is unavailable (e.g. xivo-auth, xivo-confd, Asterisk, ...)",
            "schema": {
                "$ref": "#/definitions/Error"
            }
        }
    },
    "parameters": {
        "token": {
            "required": true,
            "name": "X-Auth-Token",
            "in": "header",
            "type": "string",
            "description": "Authentication token obtained from xivo-auth."
        }
    },
    "definitions": {
        "CallRequest": {
            "type": "object",
            "properties": {
                "destination": {
                    "description": "Destination parameters",
                    "type": "object",
                    "properties": {
                        "extension": {
                            "type": "string"
                        },
                        "context": {
                            "type": "string"
                        },
                        "priority": {
                            "type": "integer"
                        }
                    }
                },
                "source": {
                    "description": "Caller parameters",
                    "type": "object",
                    "properties": {
                        "user": {
                            "type": "string"
                        }
                    }
                },
                "variables": {
                    "description": "Channel variables to set",
                    "type": "object"
                }
            }
        },
        "Call": {
            "type": "object",
            "properties": {
                "call_id": {
                    "type": "string"
                },
                "user_uuid": {
                    "type": "string"
                },
                "status": {
                    "type": "string"
                },
                "talking_to": {
                    "type": "object",
                    "properties": {
                        "<channel_id>": {
                            "type": "string"
                        }
                    }
                },
                "bridges": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "creation_time": {
                    "type": "string",
                    "format": "date-time"
                },
                "caller_id_name": {
                    "type": "string"
                },
                "caller_id_number": {
                    "type": "string"
                }
            }
        },
        "CallID": {
            "type": "object",
            "properties": {
                "call_id": {
                    "type": "string"
                }
            }
        },
        "CallBlindTransfer": {
            "type": "object",
            "properties": {
                "destination": {
                    "description": "Callee parameters",
                    "type": "object",
                    "properties": {
                        "user": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "CallAMITransfer": {
            "type": "object",
            "properties": {
                "destination": {
                    "description": "Callee parameters",
                    "type": "object",
                    "properties": {
                        "dialplan": {
                            "type": "object",
                            "properties": {
                                "exten": {
                                    "type": "string"
                                },
                                "context": {
                                    "type": "string"
                                }
                            }
                        }
                    }
                }
            }
        },
        "WaitingRoom": {
            "type": "object",
            "properties": {
                "moh": {
                    "description": "Music on hold",
                    "type": "string"
                }
            }
        },
        "ChatRequest": {
            "type": "object",
            "properties": {
                "from": {
                    "description": "From parameters",
                    "type": "string"
                },
                "to": {
                    "description": "To parameters",
                    "type": "string"
                },
                "msg": {
                    "description": "Message parameters",
                    "type": "string"
                },
                "alias": {
                    "description": "Alias parameters",
                    "type": "string"
                }
            }
        },
        "PresenceRequest": {
            "type": "object",
            "properties": {
                "user_id": {
                    "description": "User ID",
                    "type": "string"
                },
                "status_name": {
                    "description": "Presence status name (ex. available)",
                    "type": "string"
                }
            }
        },
        "Error": {
            "title": "Error",
            "description": "Error message for the client",
            "properties": {
                "message": {
                    "description": "Human readable explanation of the error",
                    "type": "string"
                },
                "error_id": {
                    "description": "Identifier of the type of error. It is more precise than the HTTP status code.",
                    "type": "string"
                },
                "details": {
                    "description": "Additional information about the error. The keys are specific to each error.",
                    "type": "object"
                },
                "timestamp": {
                    "description": "Time when the error occured",
                    "type": "number",
                    "format": "timestamp"
                }
            }
        }
    }
}
